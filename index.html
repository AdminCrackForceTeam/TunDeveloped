<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Há»‡ Thá»‘ng Tráº¯c Nghiá»‡m Full</title>
<style>
body{margin:0;font-family:Arial,sans-serif;background: linear-gradient(135deg,#2196f3,#00bcd4);color:#333;}
.box{max-width:900px;margin:20px auto;background:white;padding:20px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.3);position:relative;}
h2{text-align:center;color:#1565c0;margin-bottom:20px}
button{width:100%;padding:12px;border:none;border-radius:8px;background:#1e88e5;color:white;font-size:16px;margin:6px 0;cursor:pointer;transition:0.3s}
button:hover{background:#1565c0}
input,select{width:100%;padding:8px;margin:5px 0;border-radius:6px;border:1px solid #ccc;}
.answer{border:1px solid #ccc;padding:10px;margin:6px 0;border-radius:6px;cursor:pointer;transition:0.2s;}
.answer:hover{background:#e3f2fd; transform:scale(1.02);}
.correct{background:#43a047;color:white}
.wrong{background:#e53935;color:white}
.progress{height:10px;background:#ddd;border-radius:6px;overflow:hidden;margin:10px 0;}
.bar{height:100%;background:#1e88e5;width:0%}
.hidden{display:none}
.list{background:#f5f5f5;padding:8px;margin:6px 0;border-radius:6px;display:flex;justify-content:space-between;align-items:center;box-shadow:1px 1px 5px rgba(0,0,0,0.1);}
header{background:rgba(0,0,0,0.05);padding:10px;margin-bottom:20px;border-radius:10px;text-align:center;font-size:18px;font-weight:bold;}
hr{margin:20px 0;}
table{width:100%;border-collapse:collapse;}
table,th,td{border:1px solid #ccc;}
th,td{padding:8px;text-align:left;}
th{background:#1e88e5;color:white;}
</style>
</head>
<body>

<!-- MENU -->
<div class="box" id="menu">
<header>ğŸ“˜ Há»† THá»NG TRáº®C NGHIá»†M CHUYÃŠN NGHIá»†P</header>
<button onclick="loginTeacher()">ğŸ§‘â€ğŸ« GIÃO VIÃŠN</button>
<button onclick="openStudent()">ğŸ‘¨â€ğŸ“ Há»ŒC SINH</button>
</div>

<!-- LOGIN GIÃO VIÃŠN -->
<div class="box hidden" id="login">
<header>ğŸ”’ ÄÄƒng nháº­p giÃ¡o viÃªn</header>
<input type="password" id="pwd" placeholder="Nháº­p máº­t kháº©u giÃ¡o viÃªn">
<button onclick="checkPwd()">ÄÄƒng nháº­p</button>
<button onclick="backMenu()">â¬… Quay láº¡i MENU</button>
</div>

<!-- GIÃO VIÃŠN -->
<div class="box hidden" id="teacher">
<header>ğŸ§‘â€ğŸ« SOáº N Äá»€ / XEM ÄIá»‚M</header>

<h3>ğŸ“„ Quáº£n lÃ½ cÃ¢u há»i</h3>
<select id="subject">
<option value="toan">ğŸ“˜ ToÃ¡n</option>
<option value="nguvan">ğŸ“• Ngá»¯ VÄƒn</option>
<option value="hoa">ğŸ“— HÃ³a</option>
<option value="sinh">ğŸ“™ Sinh</option>
<option value="su">ğŸ““ Sá»­</option>
<option value="dia">ğŸ“” Äá»‹a</option>
<option value="vatly">ğŸ“’ Váº­t LÃ½</option>
</select>
<label><input type="checkbox" id="limitOnce"> Chá»‰ cho phÃ©p há»c sinh lÃ m mÃ´n nÃ y 1 láº§n trÃªn thiáº¿t bá»‹</label>
<input id="q" placeholder="Nháº­p cÃ¢u há»i">
<input id="a1" placeholder="ÄÃ¡p Ã¡n A">
<input id="a2" placeholder="ÄÃ¡p Ã¡n B">
<input id="a3" placeholder="ÄÃ¡p Ã¡n C">
<input id="a4" placeholder="ÄÃ¡p Ã¡n D">
<select id="correct">
<option value="0">ÄÃºng: A</option>
<option value="1">ÄÃºng: B</option>
<option value="2">ÄÃºng: C</option>
<option value="3">ÄÃºng: D</option>
</select>
<button onclick="addQuestion()">â• LÆ°u cÃ¢u há»i</button>
<button onclick="loadList()">ğŸ“„ Xem / XoÃ¡ cÃ¢u há»i</button>

<hr>
<h3>ğŸ“‚ Import Ä‘á» cÆ°Æ¡ng</h3>
<input type="file" id="fileInput" accept=".json">
<button onclick="importFile()">ğŸ“‚ Import Ä‘á» cÆ°Æ¡ng</button>

<hr>
<h3>ğŸ“Š Äiá»ƒm há»c sinh</h3>
<select id="scoreSubject">
<option value="toan">ğŸ“˜ ToÃ¡n</option>
<option value="nguvan">ğŸ“• Ngá»¯ VÄƒn</option>
<option value="hoa">ğŸ“— HÃ³a</option>
<option value="sinh">ğŸ“™ Sinh</option>
<option value="su">ğŸ““ Sá»­</option>
<option value="dia">ğŸ“” Äá»‹a</option>
<option value="vatly">ğŸ“’ Váº­t LÃ½</option>
</select>
<button onclick="loadScores()">Xem Ä‘iá»ƒm</button>
<div id="scores"></div>

<button onclick="backMenu()">â¬… Quay láº¡i MENU</button>
<div id="list"></div>
</div>

<!-- Há»ŒC SINH -->
<div class="box hidden" id="student">
<header>ğŸ“˜ LÃ€M BÃ€I</header>
<input id="studentName" placeholder="Nháº­p tÃªn há»c sinh">
<select id="subChoose">
<option value="toan">ğŸ“˜ ToÃ¡n</option>
<option value="nguvan">ğŸ“• Ngá»¯ VÄƒn</option>
<option value="hoa">ğŸ“— HÃ³a</option>
<option value="sinh">ğŸ“™ Sinh</option>
<option value="su">ğŸ““ Sá»­</option>
<option value="dia">ğŸ“” Äá»‹a</option>
<option value="vatly">ğŸ“’ Váº­t LÃ½</option>
</select>
<button onclick="startQuiz()">â–¶ Báº¯t Ä‘áº§u</button>
<div class="progress"><div class="bar" id="bar"></div></div>
<div id="quiz"></div>
<button onclick="next()" id="nextBtn">Tiáº¿p theo</button>
<div id="result"></div>
<button class="hidden" id="backStudent" onclick="backMenu()">â¬… Quay láº¡i MENU</button>
</div>

<!-- Ã‚m thanh má»›i -->
<audio id="ting" src="https://freesound.org/data/previews/341/341695_6261545-lq.mp3"></audio>
<audio id="wrong" src="https://freesound.org/data/previews/456/456618_7037-lq.mp3"></audio>

<script>
const teacherPwd="123456"; 
let questions=[],i=0,score=0,selected=-1;
let studentName="";

// ===== MENU =====
function backMenu(){
    menu.classList.remove("hidden");
    login.classList.add("hidden");
    teacher.classList.add("hidden");
    student.classList.add("hidden");
    document.getElementById("result").innerHTML="";
    document.getElementById("quiz").innerHTML="";
    document.getElementById("bar").style.width="0%";
    document.getElementById("backStudent").classList.add("hidden");
    document.getElementById("nextBtn").classList.remove("hidden");
}

// ===== GIÃO VIÃŠN =====
function loginTeacher(){
    menu.classList.add("hidden");
    login.classList.remove("hidden");
}
function checkPwd(){
    if(document.getElementById("pwd").value===teacherPwd){
        login.classList.add("hidden");
        teacher.classList.remove("hidden");
        document.getElementById("pwd").value="";
    }else{
        alert("Sai máº­t kháº©u!");
    }
}

function getData(){
    let sub=document.getElementById("subject").value;
    return JSON.parse(localStorage.getItem("quiz_"+sub)||"[]");
}
function saveData(data){
    let sub=document.getElementById("subject").value;
    localStorage.setItem("quiz_"+sub,JSON.stringify(data));
    // lÆ°u giá»›i háº¡n 1 láº§n náº¿u tick
    if(document.getElementById("limitOnce").checked){
        localStorage.setItem("limit_"+sub,"true");
    } else {
        localStorage.removeItem("limit_"+sub);
    }
}

function addQuestion(){
    let data=getData();
    let qVal=document.getElementById("q").value;
    let a1Val=document.getElementById("a1").value;
    let a2Val=document.getElementById("a2").value;
    let a3Val=document.getElementById("a3").value;
    let a4Val=document.getElementById("a4").value;
    if(!qVal||!a1Val||!a2Val||!a3Val||!a4Val){alert("Vui lÃ²ng nháº­p Ä‘áº§y Ä‘á»§!"); return;}
    data.push({q:qVal,a:[a1Val,a2Val,a3Val,a4Val],c:parseInt(document.getElementById("correct").value)});
    saveData(data);
    alert("ÄÃ£ lÆ°u!");
    document.getElementById("q").value=document.getElementById("a1").value=document.getElementById("a2").value=document.getElementById("a3").value=document.getElementById("a4").value="";
}

function loadList(){
    let data=getData();
    let listDiv=document.getElementById("list");
    listDiv.innerHTML="";
    if(data.length===0){listDiv.innerHTML="ChÆ°a cÃ³ cÃ¢u há»i!"; return;}
    data.forEach((x,index)=>{
        let div=document.createElement("div");
        div.className="list";
        div.innerHTML=`<span>${index+1}. ${x.q}</span><button onclick="del(${index})">âŒ XoÃ¡</button>`;
        listDiv.appendChild(div);
    });
}

function del(index){
    let data=getData();
    data.splice(index,1);
    saveData(data);
    loadList();
}

// ===== IMPORT FILE JSON =====
function importFile(){
  const file=document.getElementById("fileInput").files[0];
  if(!file){alert("Chá»n file trÆ°á»›c!"); return;}
  const reader=new FileReader();
  reader.onload=function(e){
    try{
      const data=JSON.parse(e.target.result);
      if(!Array.isArray(data)) throw "File khÃ´ng há»£p lá»‡";
      let current=getData();
      current=current.concat(data);
      saveData(current);
      alert("Import thÃ nh cÃ´ng "+data.length+" cÃ¢u!");
      loadList();
    }catch(err){
      alert("File khÃ´ng há»£p lá»‡: "+err);
    }
  }
  reader.readAsText(file);
}

// ===== XEM ÄIá»‚M =====
function loadScores(){
    let sub=document.getElementById("scoreSubject").value;
    let scores=JSON.parse(localStorage.getItem("score_"+sub)||"[]");
    let div=document.getElementById("scores");
    if(scores.length===0){div.innerHTML="ChÆ°a cÃ³ há»c sinh nÃ o lÃ m bÃ i."; return;}
    scores.sort((a,b)=>new Date(b.date)-new Date(a.date));
    let html="<table><tr><th>TÃªn</th><th>Äiá»ƒm</th><th>Tá»•ng</th><th>NgÃ y giá»</th></tr>";
    scores.forEach(s=>{html+=`<tr><td>${s.name}</td><td>${s.score}</td><td>${s.total}</td><td>${s.date}</td></tr>`;});
    html+="</table>";
    div.innerHTML=html;
}

// ===== Há»ŒC SINH =====
function openStudent(){
    menu.classList.add("hidden");
    student.classList.remove("hidden");
    document.getElementById("quiz").innerHTML="";
    document.getElementById("result").innerHTML="";
}

function startQuiz(){
    studentName=document.getElementById("studentName").value.trim();
    if(studentName===""){alert("Nháº­p tÃªn há»c sinh trÆ°á»›c!"); return;}
    let sub=document.getElementById("subChoose").value;

    // kiá»ƒm tra giá»›i háº¡n 1 láº§n
    if(localStorage.getItem("limit_"+sub) && localStorage.getItem("done_"+sub)){
        alert("Báº¡n chá»‰ Ä‘Æ°á»£c lÃ m mÃ´n nÃ y 1 láº§n trÃªn thiáº¿t bá»‹ nÃ y!");
        return;
    }

    questions=JSON.parse(localStorage.getItem("quiz_"+sub)||"[]");
    if(questions.length===0){alert("ChÆ°a cÃ³ Ä‘á»!"); return;}
    i=0;score=0;selected=-1;
    document.getElementById("backStudent").classList.add("hidden");
    document.getElementById("nextBtn").classList.remove("hidden");
    loadQ();
}

function loadQ(){
    let q=questions[i];
    let quizDiv=document.getElementById("quiz");
    quizDiv.innerHTML=`<b>CÃ¢u ${i+1}: ${q.q}</b>`;
    q.a.forEach((x,j)=>{quizDiv.innerHTML+=`<div class="answer" onclick="choose(${j},this)">${x}</div>`;});
    document.getElementById("bar").style.width=(i/questions.length*100)+"%";
}

function choose(j,el){
    selected=j;
    document.querySelectorAll(".answer").forEach(e=>e.classList.remove("active"));
    el.classList.add("active");
}

function next(){
    if(selected===-1){alert("Chá»n Ä‘Ã¡p Ã¡n!"); return;}
    let q=questions[i];
    let ans=document.querySelectorAll(".answer");
    if(selected===q.c){ans[selected].classList.add("correct"); document.getElementById("ting").play(); score++;}
    else{ans[selected].classList.add("wrong"); document.getElementById("wrong").play();}
    setTimeout(()=>{
        i++; selected=-1;
        if(i<questions.length) loadQ();
        else{
            document.getElementById("quiz").innerHTML="";
            document.getElementById("result").innerHTML=`ğŸ‰ HoÃ n thÃ nh<br>Äiá»ƒm: <b>${score}/${questions.length}</b>`;
            document.getElementById("backStudent").classList.remove("hidden");
            document.getElementById("nextBtn").classList.add("hidden");
            document.getElementById("bar").style.width="100%";
            saveStudentScore();
        }
    },600);
}

function saveStudentScore(){
    let sub=document.getElementById("subChoose").value;
    let scores=JSON.parse(localStorage.getItem("score_"+sub)||"[]");
    let now=new Date();
    scores.push({name:studentName,score:score,total:questions.length,date:now.toLocaleString()});
    localStorage.setItem("score_"+sub,JSON.stringify(scores));

    // Ä‘Ã¡nh dáº¥u Ä‘Ã£ lÃ m náº¿u giá»›i háº¡n 1 láº§n
    if(localStorage.getItem("limit_"+sub)){
        localStorage.setItem("done_"+sub,"true");
    }
}
</script>
</body>
</html>
